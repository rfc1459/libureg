PROJECT(libureg)

CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

INCLUDE(CheckFunctionExists)

MACRO(FIND_BISON)
	IF(NOT BISON_EXECUTABLE)
		MESSAGE("-- Looking for bison executable")
		FIND_PROGRAM(BISON_EXECUTABLE bison)
		IF(NOT BISON_EXECUTABLE)
			MESSAGE(FATAL_ERROR "bison not found - aborting")
		ENDIF(NOT BISON_EXECUTABLE)
	ENDIF(NOT BISON_EXECUTABLE)
ENDMACRO(FIND_BISON)

FIND_BISON()

SET(ureg_LIB_SRCS
compile.c
${PROJECT_BINARY_DIR}/parse.c
thompsonvm.c
)

ADD_CUSTOM_COMMAND(SOURCE ${PROJECT_SOURCE_DIR}/parse.y
	COMMAND ${BISON_EXECUTABLE}
	ARGS ${PROJECT_SOURCE_DIR}/parse.y
	     -o ${PROJECT_BINARY_DIR}/parse.c
	TARGET uregParser
	OUTPUTS ${PROJECT_BINARY_DIR}/parse.c)

SET_SOURCE_FILES_PROPERTIES(${PROJECT_BINARY_DIR}/parse.c GENERATED)
INCLUDE_DIRECTORIES(${PROJECT_BINARY_DIR} ${PROJECT_SOURCE_DIR})

ADD_LIBRARY(ureg STATIC ${ureg_LIB_SRCS})
